# Firebase Auth 설정 가이드

## 변경된 파일 목록

### 1. `src/composables/useAuth.ts`
- **주요 변경사항:**
  - 모듈 레벨에서 `onAuthStateChanged` 구독 설정 (앱 시작 시 자동 초기화)
  - `signUpWithEmail()`: 이메일/비밀번호 회원가입 구현
  - `signInWithEmail()`: 이메일/비밀번호 로그인 구현
  - `sendPasswordReset()`: 비밀번호 재설정 이메일 발송 구현
  - `signInWithGoogle()`: 구글 로그인 (기존 유지, 에러 처리 개선)
  - `signOut()`: 로그아웃 구현
  - `getAuthErrorMessage()`: Firebase 에러 코드를 사용자 친화적 메시지로 변환
  - `authReady`, `isLoggedIn` 상태 추가
  - Firestore users 문서 자동 생성 로직 통합

### 2. `src/views/auth/Login.vue`
- **주요 변경사항:**
  - `useAuth` composable 사용으로 변경
  - 비밀번호 재설정 링크 추가
  - redirect 쿼리 파라미터 처리 (로그인 후 원래 페이지로 복귀)
  - 로딩 상태 및 에러 처리 개선
  - Firebase 에러 메시지 사용자 친화적 표시

### 3. `src/views/auth/SignUp.vue`
- **주요 변경사항:**
  - 실제 Firebase Auth 회원가입 구현
  - 비밀번호 확인 필드 추가
  - 클라이언트 사이드 검증 (이메일 형식, 비밀번호 길이, 비밀번호 일치 확인)
  - Firebase 에러 메시지 사용자 친화적 표시
  - 회원가입 성공 시 자동 로그인 및 홈으로 이동
  - redirect 쿼리 파라미터 처리

### 4. `src/router/index.ts`
- **주요 변경사항:**
  - `authReady` 기반 라우터 가드로 변경
  - `authReady`가 false일 때 대기 로직 추가 (깜빡임/무한리다이렉트 방지)
  - 미로그인 사용자 접근 시 `/login?redirect=<원래경로>`로 리다이렉트
  - 공개 페이지(`meta.public === true`)는 인증 없이 접근 가능

### 5. `src/main.ts`
- **주요 변경사항:**
  - `useAuth` 모듈 import 추가 (앱 시작 시 인증 상태 구독 시작)

### 6. `src/services/userService.ts`
- **기존 함수 활용:**
  - `createUserProfile()`: 회원가입 시 Firestore users 문서 생성에 사용

## Firebase 콘솔 설정

### 1. 이메일/비밀번호 로그인 활성화

1. Firebase 콘솔 접속: https://console.firebase.google.com/
2. 프로젝트 선택: `checknest-web`
3. 왼쪽 메뉴에서 **Authentication** 클릭
4. **Sign-in method** 탭 클릭
5. **이메일/비밀번호** 제공업체 찾기
6. **사용 설정** 클릭
7. **이메일/비밀번호** 활성화
8. **저장** 클릭

### 2. 비밀번호 재설정 이메일 템플릿 설정 (선택사항)

1. Authentication > Templates 탭
2. **비밀번호 재설정** 템플릿 선택
3. 이메일 제목 및 본문 커스터마이징 가능
4. **저장** 클릭

### 3. 이메일 인증 설정 (선택사항, 향후 확장용)

1. Authentication > Sign-in method
2. **이메일/비밀번호** 설정에서 **이메일 링크(비밀번호 없이 로그인)** 활성화 가능

## 테스트 체크리스트

### ✅ 회원가입 테스트
- [ ] 이메일로 회원가입 후 즉시 로그인 상태 유지됨
- [ ] 중복 이메일 가입 시도 시 "이미 사용 중인 이메일입니다." 메시지 표시
- [ ] 비밀번호 6자 미만 입력 시 "비밀번호는 6자 이상이어야 합니다." 메시지 표시
- [ ] 비밀번호 확인 불일치 시 "비밀번호가 일치하지 않습니다." 메시지 표시
- [ ] 회원가입 성공 시 Firestore `users/{uid}` 문서 생성 확인

### ✅ 로그인 테스트
- [ ] 로그아웃 후 이메일/비밀번호로 로그인 가능
- [ ] 잘못된 비밀번호 입력 시 "비밀번호가 올바르지 않습니다." 메시지 표시
- [ ] 등록되지 않은 이메일 입력 시 "등록되지 않은 이메일입니다." 메시지 표시
- [ ] 로그인 성공 시 홈(`/`)으로 이동

### ✅ 비밀번호 재설정 테스트
- [ ] 비밀번호 재설정 버튼 클릭 시 이메일 발송
- [ ] "비밀번호 재설정 이메일을 발송했습니다." 메시지 표시
- [ ] 등록되지 않은 이메일 입력 시 적절한 에러 메시지 표시

### ✅ 라우터 가드 테스트
- [ ] 로그인하지 않은 상태에서 보호된 페이지 접근 시 `/login?redirect=<원래경로>`로 이동
- [ ] 로그인 후 원래 페이지로 자동 복귀
- [ ] 공개 페이지(`/terms`, `/privacy`)는 로그인 없이 접근 가능
- [ ] 로그인 페이지(`/login`)는 로그인 상태에서도 접근 가능

### ✅ 구글 로그인 테스트
- [ ] 구글 로그인 버튼 클릭 시 팝업 표시
- [ ] 구글 로그인 성공 시 홈으로 이동
- [ ] 구글 로그인 시 Firestore users 문서 자동 생성 확인

### ✅ 로그아웃 테스트
- [ ] 로그아웃 후 로그인 페이지로 이동
- [ ] 로그아웃 후 보호된 페이지 접근 시 로그인 페이지로 리다이렉트

## 주의사항

1. **Firebase 콘솔에서 이메일/비밀번호 로그인을 반드시 활성화해야 합니다.**
2. **비밀번호 최소 길이는 Firebase 기본값(6자)을 따릅니다.**
3. **회원가입 시 Firestore `users` 문서가 자동 생성되지만, 실패해도 회원가입은 성공으로 처리됩니다.**
4. **라우터 가드는 `authReady`가 true가 될 때까지 대기하므로, 초기 로딩 시 깜빡임이 없습니다.**

## 에러 코드 매핑

다음 Firebase Auth 에러 코드가 사용자 친화적 메시지로 변환됩니다:

- `auth/invalid-email`: "유효하지 않은 이메일 주소입니다."
- `auth/user-disabled`: "이 계정은 비활성화되었습니다."
- `auth/user-not-found`: "등록되지 않은 이메일입니다."
- `auth/wrong-password`: "비밀번호가 올바르지 않습니다."
- `auth/invalid-credential`: "이메일 또는 비밀번호가 올바르지 않습니다."
- `auth/email-already-in-use`: "이미 사용 중인 이메일입니다."
- `auth/weak-password`: "비밀번호가 너무 약합니다. 6자 이상 입력해주세요."
- `auth/too-many-requests`: "너무 많은 요청이 발생했습니다. 잠시 후 다시 시도해주세요."
- `auth/network-request-failed`: "네트워크 오류가 발생했습니다. 인터넷 연결을 확인해주세요."

## 다음 단계 (선택사항)

1. **이메일 인증 추가**: 회원가입 후 이메일 인증 요구
2. **소셜 로그인 확장**: Apple, Facebook 등 추가 제공업체
3. **비밀번호 강도 검증**: 더 강력한 비밀번호 정책 적용
4. **토스트 알림 시스템**: alert() 대신 토스트 메시지로 개선
5. **로딩 스피너**: 로그인/회원가입 중 로딩 상태 시각화 개선

